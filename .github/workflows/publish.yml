name: Publish Extensions
run-name: Publish Extensions (${{ github.sha }})

on:
  push:
    branches:
      - main

jobs:
  publish:
    runs-on: ubuntu-latest
    steps:
      # Setup
      - uses: actions/checkout@11bd71901bbe5b1630ceea73d27597364c9af683 # v4.2.2
      - uses: jdx/mise-action@5083fe46898c414b2475087cc79da59e7da859e8 # v2.1.11

      # Cache npm
      - name: Get npm cache directory
        id: npm-cache-dir
        shell: bash
        run: echo "result=$(npm config get cache)" >> "${GITHUB_OUTPUT}"
      - uses: actions/cache@0c907a75c2c80ebcb7f088228285e798b750cf8f # v4.2.1
        with:
          path: ${{ steps.npm-cache-dir.outputs.result }}
          key: ${{ runner.os }}-node-${{ hashFiles('**/package-lock.json') }}
          restore-keys: |
            ${{ runner.os }}-node-

      # Install dependencies
      - run: npm ci

      # Publish
      - run: npm run publish
        env:
          RAY_TOKEN: ${{ secrets.RAYCAST_ORGANIZATION_TOKEN }}
